// NO generator block - Raw SQL only
// This schema is for documentation purposes only
// Main DB operations use pg Client directly to avoid Prisma conflicts

datasource db {
  provider = "postgresql"
  url      = env("MAIN_DATABASE_URL")
}

// Plan table - Shared across all tenants (Super Admin manages)
model Plan {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String
  basePrice   Float
  currency    String   @default("USD")
  trialDays   Int      @default(14)
  limits      String   @default("{\"outlets\": 0, \"users\": 0, \"products\": 0, \"customers\": 0}")
  features    String   @default("[]")
  isActive    Boolean  @default(true)
  isPopular   Boolean  @default(false)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  @@index([isActive])
  @@index([sortOrder])
  @@index([deletedAt])
}

// SIMPLIFIED: Only Tenant table (replaces Merchant)
// 1 Tenant = 1 Business = 1 isolated database
// Contains ALL business information
model Tenant {
  id          String   @id @default(cuid())
  subdomain   String   @unique
  
  // Business Info (from Merchant model)
  name        String
  email       String   @unique
  phone       String?
  
  // Address Info
  address     String?
  city        String?
  state       String?
  zipCode     String?
  country     String?
  
  // Business Details
  taxId       String?  // Tax ID / EIN
  businessType String? // e.g., "GENERAL", "VEHICLE", "EQUIPMENT"
  website     String?
  description String?
  
  // Multi-tenant specific
  databaseUrl String
  status      String   @default("active") // active, inactive, suspended
  
  // Subscription info - References Plan in Main DB
  planId            Int?
  subscriptionStatus String?   @default("trial") // trial, active, past_due, canceled
  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?
  trialStart         DateTime?
  trialEnd           DateTime?
  canceledAt         DateTime?
  cancelReason       String?
  
  // Metadata
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([subdomain])
  @@index([status])
  @@index([email])
  @@index([subscriptionStatus])
  @@index([planId])
}

