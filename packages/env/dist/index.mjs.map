{"version":3,"sources":["../src/index.ts"],"sourcesContent":["/**\n * ============================================================================\n * CENTRALIZED ENVIRONMENT CONFIGURATION\n * ============================================================================\n * \n * Type-safe environment variable management for the entire monorepo.\n * Single source of truth for all apps (client, admin, API).\n * \n * Usage:\n *   import { env } from '@rentalshop/env';\n *   const dbUrl = env.DATABASE_URL; // Type-safe!\n * \n * Best Practices:\n * - All environment variables are validated on import\n * - Type-safe access throughout the application\n * - Fails fast with clear error messages\n * - Production validation ensures security\n */\n\nimport { z } from 'zod';\n\n// ============================================================================\n// ENVIRONMENT SCHEMA\n// ============================================================================\n\nconst envSchema = z.object({\n  // Node Environment\n  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n  \n  // Database\n  DATABASE_URL: z.string().min(1, 'DATABASE_URL is required'),\n  \n  // JWT\n  JWT_SECRET: z.string().min(1, 'JWT_SECRET is required'),\n  JWT_EXPIRES_IN: z.string().default('7d'),\n  \n  // NextAuth\n  NEXTAUTH_SECRET: z.string().min(1, 'NEXTAUTH_SECRET is required'),\n  NEXTAUTH_URL: z.string().url('NEXTAUTH_URL must be a valid URL'),\n  \n  // API URLs\n  CLIENT_URL: z.string().url('CLIENT_URL must be a valid URL'),\n  ADMIN_URL: z.string().url('ADMIN_URL must be a valid URL'),\n  API_URL: z.string().url('API_URL must be a valid URL'),\n  \n  // CORS\n  CORS_ORIGINS: z.string().default(''),\n  \n  // File Upload\n  UPLOAD_PROVIDER: z.enum(['local', 'cloudinary', 's3']).default('local'),\n  UPLOAD_PATH: z.string().optional(),\n  MAX_FILE_SIZE: z.string().transform(val => parseInt(val, 10)).default('10485760'),\n  \n  // Cloudinary (optional)\n  CLOUDINARY_CLOUD_NAME: z.string().optional(),\n  CLOUDINARY_API_KEY: z.string().optional(),\n  CLOUDINARY_API_SECRET: z.string().optional(),\n  \n  // Email\n  EMAIL_PROVIDER: z.enum(['console', 'resend', 'sendgrid']).default('console'),\n  EMAIL_FROM: z.string().email('EMAIL_FROM must be a valid email').default('noreply@localhost'),\n  RESEND_API_KEY: z.string().optional(),\n  \n  // Redis (optional)\n  REDIS_URL: z.string().optional(),\n  \n  // Logging\n  LOG_LEVEL: z.enum(['debug', 'info', 'warn', 'error']).default('info'),\n  LOG_FORMAT: z.enum(['pretty', 'json']).default('json'),\n  \n  // Feature Flags\n  ENABLE_EMAIL_VERIFICATION: z.string().transform(val => val === 'true').default('false'),\n  ENABLE_ANALYTICS: z.string().transform(val => val === 'true').default('false'),\n  ENABLE_DEBUG_LOGS: z.string().transform(val => val === 'true').default('false'),\n  \n  // Rate Limiting\n  RATE_LIMIT_WINDOW: z.string().default('15m'),\n  RATE_LIMIT_MAX: z.string().transform(val => parseInt(val, 10)).default('100'),\n  \n  // Stripe (optional)\n  STRIPE_PUBLISHABLE_KEY: z.string().optional(),\n  STRIPE_SECRET_KEY: z.string().optional(),\n  STRIPE_WEBHOOK_SECRET: z.string().optional(),\n  \n  // Monitoring (optional)\n  SENTRY_DSN: z.string().optional(),\n  SENTRY_ENVIRONMENT: z.string().optional(),\n});\n\n// ============================================================================\n// PARSE AND VALIDATE ENVIRONMENT\n// ============================================================================\n\nfunction parseEnvironment() {\n  try {\n    const parsed = envSchema.safeParse(process.env);\n    \n    if (!parsed.success) {\n      console.error('‚ùå Environment validation failed:');\n      console.error(parsed.error.format());\n      throw new Error('Invalid environment configuration. Check the errors above.');\n    }\n    \n    const env = parsed.data;\n    \n    // Additional production validation\n    if (env.NODE_ENV === 'production') {\n      // Ensure secrets are not default/weak values\n      if (env.JWT_SECRET.includes('local') || env.JWT_SECRET.includes('DO-NOT-USE')) {\n        throw new Error('JWT_SECRET must be changed for production! Generate with: openssl rand -hex 32');\n      }\n      \n      if (env.NEXTAUTH_SECRET.includes('local') || env.NEXTAUTH_SECRET.includes('DO-NOT-USE')) {\n        throw new Error('NEXTAUTH_SECRET must be changed for production! Generate with: openssl rand -hex 32');\n      }\n      \n      // Ensure production URLs use HTTPS\n      if (!env.CLIENT_URL.startsWith('https://')) {\n        throw new Error('CLIENT_URL must use HTTPS in production');\n      }\n      \n      if (!env.API_URL.startsWith('https://')) {\n        throw new Error('API_URL must use HTTPS in production');\n      }\n      \n      // Warn about missing optional but recommended configs\n      if (!env.REDIS_URL) {\n        console.warn('‚ö†Ô∏è  REDIS_URL not set - caching will be disabled');\n      }\n      \n      if (!env.SENTRY_DSN) {\n        console.warn('‚ö†Ô∏è  SENTRY_DSN not set - error monitoring will be disabled');\n      }\n    }\n    \n    return env;\n  } catch (error) {\n    console.error('üí• Failed to load environment configuration:');\n    console.error(error);\n    process.exit(1);\n  }\n}\n\n// ============================================================================\n// EXPORT VALIDATED ENVIRONMENT\n// ============================================================================\n\n/**\n * Validated and type-safe environment configuration\n * Use this throughout your application instead of process.env\n */\nexport const env = parseEnvironment();\n\n/**\n * Environment type\n */\nexport type Env = z.infer<typeof envSchema>;\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\n/**\n * Check if in development mode\n */\nexport const isDevelopment = () => env.NODE_ENV === 'development';\n\n/**\n * Check if in production mode\n */\nexport const isProduction = () => env.NODE_ENV === 'production';\n\n/**\n * Check if in test mode\n */\nexport const isTest = () => env.NODE_ENV === 'test';\n\n/**\n * Get CORS origins as array\n */\nexport function getCorsOrigins(): string[] {\n  return env.CORS_ORIGINS\n    .split(',')\n    .map(origin => origin.trim())\n    .filter(Boolean);\n}\n\n/**\n * Get database URL with proper path resolution\n */\nexport function getDatabaseUrl(): string {\n  const url = env.DATABASE_URL;\n  \n  // If using external database, return as-is\n  if (url.startsWith('postgresql://') || \n      url.startsWith('mysql://') ||\n      url.startsWith('mongodb://')) {\n    return url;\n  }\n  \n  // For SQLite, ensure path is from project root\n  if (url.startsWith('file:')) {\n    return url;\n  }\n  \n  return url;\n}\n\n/**\n * Print environment info (safe - no secrets)\n */\nexport function printEnvironmentInfo(): void {\n  console.log('üîß Environment Configuration:');\n  console.log(`  NODE_ENV: ${env.NODE_ENV}`);\n  console.log(`  DATABASE: ${env.DATABASE_URL.substring(0, 30)}...`);\n  console.log(`  CLIENT_URL: ${env.CLIENT_URL}`);\n  console.log(`  ADMIN_URL: ${env.ADMIN_URL}`);\n  console.log(`  API_URL: ${env.API_URL}`);\n  console.log(`  LOG_LEVEL: ${env.LOG_LEVEL}`);\n  console.log(`  EMAIL_PROVIDER: ${env.EMAIL_PROVIDER}`);\n  console.log(`  UPLOAD_PROVIDER: ${env.UPLOAD_PROVIDER}`);\n  console.log(`  Features: Email=${env.ENABLE_EMAIL_VERIFICATION}, Analytics=${env.ENABLE_ANALYTICS}`);\n  console.log('‚úÖ Environment loaded successfully');\n}\n\n// ============================================================================\n// AUTO-PRINT IN DEVELOPMENT\n// ============================================================================\n\nif (isDevelopment() && env.ENABLE_DEBUG_LOGS) {\n  printEnvironmentInfo();\n}\n\n// Export all for convenience\nexport default env;\n\n"],"mappings":"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","names":["env"]}